<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=hugo-theme content="Axiom 0.8.0"><link rel=icon type=image/png sizes=32x32 href=/image/brand/favicon.png><link rel=icon type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon href=/image/brand/icon-1-1.png><link rel=canonical href=https://oudwud.dev/2304182106-why-prevote-in-tendermint/><link rel=preload as=style href="/bundle.css?v=1683215241" media=all><link rel=stylesheet href="/bundle.css?v=1683215241" media=all><style>.cdata pre{background-color:#1f2937;color:#e5e7eb}.cdata :not(pre)>code{background-color:#f3f4f6;color:#7c3aed}.chroma .err{background-color:#991b1b;color:#fecaca}.chroma .hl{background-color:#374151}.chroma .ln{color:#9ca3af}.chroma .k,.chroma .kc,.chroma .kd,.chroma .kn,.chroma .kp,.chroma .kr{color:#60a5fa}.chroma .kt{color:#a78bfa}.chroma .na,.chroma .nb{color:#fbbf24}.chroma .nc{color:#f87171}.chroma .no{color:#34d399}.chroma .nd{color:#f87171}.chroma .ne{color:#f87171}.chroma .nf{color:#fbbf24}.chroma .nt{color:#f87171}.chroma .l{color:#a78bfa}.chroma .dl,.chroma .ld,.chroma .s,.chroma .s2,.chroma .sa,.chroma .sb,.chroma .sc,.chroma .sd{color:#34d399}.chroma .se{color:#9ca3af}.chroma .s1,.chroma .sh,.chroma .si,.chroma .sr,.chroma .ss,.chroma .sx{color:#34d399}.chroma .il,.chroma .m,.chroma .mb,.chroma .mf,.chroma .mh,.chroma .mi,.chroma .mo{color:#a78bfa}.chroma .o,.chroma .ow{color:#93c5fd}.chroma .c,.chroma .c1,.chroma .ch,.chroma .cm,.chroma .cp,.chroma .cpf,.chroma .cs,.chroma .p{color:#9ca3af}.chroma .ge{font-style:italic}.chroma .gs{font-weight:700}</style><title>Why prevote in Tendermint : Youngjoon Lee</title><meta property="og:title" content="Why prevote in Tendermint"><meta property="og:site_name" content="Youngjoon Lee"><meta property="og:url" content="https://oudwud.dev/2304182106-why-prevote-in-tendermint/"><link rel=image_src href=https://oudwud.dev/image/page-default.webp><meta property="og:image" content="https://oudwud.dev/image/page-default.webp"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="og:type" content="article"><meta property="og:locale" content="en_us"><meta property="og:description" content="Tendermint Byzantine Fault Tolerance (hereafter BFT) consensus algorithm has two stages of voting before committing a block to the state, while Raft consensus algorithm (that doesn't cover the Byzantine problem) has a single stage of preparation (aka. log replication) for committing a transaction."><meta name=description content="Tendermint Byzantine Fault Tolerance (hereafter BFT) consensus algorithm has two stages of voting before committing a block to the state, while Raft consensus algorithm (that doesn't cover the Byzantine problem) has a single stage of preparation (aka. log replication) for committing a transaction."><meta property="og:updated_time" content="2023-04-18T12:06:00Z"><meta property="fb:app_id" content><meta name=author content="Youngjoon Lee"><meta property="article:author" content="https://oudwud.dev"><meta property="article:published_time" content="2023-04-18T12:06:00Z"><meta property="article:modified_time" content="2023-04-18T12:06:00Z"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","headline":"Why prevote in Tendermint","alternativeHeadline":"Tendermint Byzantine Fault Tolerance (hereafter BFT) consensus algorithm has two stages of voting before committing a block to the state, while Raft consensus algorithm (that doesn't cover the Byzantine problem) has a single stage of preparation (aka. log replication) for committing a transaction.","url":"https://oudwud.dev/2304182106-why-prevote-in-tendermint/","image":"https://oudwud.dev/image/page-default.webp","mainEntityOfPage":{"@type":"WebPage","@id":"https://oudwud.dev/2304182106-why-prevote-in-tendermint/"},"description":"Tendermint Byzantine Fault Tolerance (hereafter BFT) consensus algorithm has two stages of voting before committing a block to the state, while Raft consensus algorithm (that doesn't cover the Byzantine problem) has a single stage of preparation (aka. log replication) for committing a transaction.","author":{"@type":"Person","name":"Youngjoon Lee"},"publisher":{"@type":"Organization","name":"Youngjoon Lee","logo":{"@type":"ImageObject","url":"https://oudwud.dev/image/brand/icon-1-1.png"}},"datePublished":"2023-04-18T12:06:00Z","dateModified":"2023-04-18T12:06:00Z","articleBody":"\u003cp\u003eTendermint Byzantine Fault Tolerance (hereafter BFT) consensus algorithm has two stages of voting before committing a block to the state,\nwhile Raft consensus algorithm (that doesn't cover the Byzantine problem) has a single stage of preparation (aka. log replication) for committing a transaction.\nWhen I first met Tendermint, I was most curious why Tendermint has the two-stage voting (prevote-precommit).\u003c/p\u003e\n\u003cp\u003eIn \u003ca href=\"https://atrium.lib.uoguelph.ca/xmlui/handle/10214/9769\"\u003eEthan Buchman 2016\u003c/a\u003e, he mentioned as below:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eIn asynchronous environments with Byzantine validators, a single stage\nof voting, where each validator casts only one vote, is not sufficient to ensure\nsafety. In essence, because validators can act fraudulently, and because there\nare no guarantees on message delivery time, a rogue validator can co-ordinate\nsome validators to commit a value while others, having not seen the commit,\ngo to a new round, within which they commit a different value.\n\u003cbr\u003e\nA single stage of voting allows validators to tell each other what they\nknow about the proposal. But to tolerate Byzantine faults (which amounts,\nessentially to lies, fraud, deceit, etc.), they must also tell each other what\nthey know about what other validators have professed to know about the\nproposal. In other words, a second stage ensures that enough validators\nwitnessed the result of the first stage.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThat sounds reasonable, but I wanted to see a specific counterexample that explains why only precommit without prevote is not sufficient.\u003c/p\u003e\n\u003cp\u003eFortunately, I found a counterexample from a \u003ca href=\"https://www.reddit.com/r/cosmosnetwork/comments/8zwais/comment/e2nyg92/?utm_source=reddit\u0026amp;utm_medium=web2x\u0026amp;context=3\"\u003eReddit post\u003c/a\u003e.\nBelow, I am going to go into details on this counterexample.\u003c/p\u003e\n\u003cp\u003eLet's assume that Tendermint has only single stage of voting (aka. precommit), and the network consists of the following validator nodes:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e100 validator nodes in the network\n\u003cul\u003e\n\u003cli\u003e28 offline nodes (e.g. due to network partitioning)\u003c/li\u003e\n\u003cli\u003e65 honest nodes\u003c/li\u003e\n\u003cli\u003e1 honest node (aka. \u003ccode\u003eH\u003c/code\u003e)\u003c/li\u003e\n\u003cli\u003e1 Byzantine node (aka. \u003ccode\u003eB\u003c/code\u003e)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eLet's say the current round is \u003ccode\u003en\u003c/code\u003e. A \u0026quot;valid\u0026quot; block is proposed by one of the validators.\nThen, all 66 (= 65 + 1) honest nodes broadcast a precommit for this valid block.\nBut, let's imagine the case when the Byzantine node \u003ccode\u003eB\u003c/code\u003e sends \u003ccode\u003enil\u003c/code\u003e to 65 honest nodes and itself, but a precommit to the honest node \u003ccode\u003eH\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eIn this case, \u003ccode\u003eH\u003c/code\u003e has 67 precommits (\u003ccode\u003e\u0026gt; 100 * 2/3\u003c/code\u003e) with its own vote. Then, \u003ccode\u003eH\u003c/code\u003e will commit the block.\nHowever, all other nodes (65 honest + \u003ccode\u003eB\u003c/code\u003e) move to the next round \u003ccode\u003en+1\u003c/code\u003e because they have only 66 precommits (\u003ccode\u003e\u0026lt; 100 * 2/3\u003c/code\u003e).\u003c/p\u003e\n\u003cp\u003eThis result is a breach of safety because the honest node \u003ccode\u003eH\u003c/code\u003e committed the block that all other honest nodes didn't commit.\u003c/p\u003e\n\u003cp\u003eIf Tendermint has the prevote-precommit mechanism, the above example can be resolved safely.\nLet's replace all precommits in the above example with prevotes.\nThen, \u003ccode\u003eH\u003c/code\u003e will broadcast a precommit to all other nodes instead of committing the block to its state,\nbut it won't receive 2/3+ precommit from other nodes because all other nodes except \u003ccode\u003eH\u003c/code\u003e won't broadcast a precommit since they didn't receive 2/3+ prevotes.\nAs a result, all nodes will move to the next round \u003ccode\u003en+1\u003c/code\u003e without committing the block.\nThen, the consensus remains safe, even if any new block never be committed due to \u003ccode\u003eB\u003c/code\u003e in subsequent rounds.\u003c/p\u003e"}</script><link rel=preload as=script href="/bundle.js?v=1683215241"></head><body><header id=nav class=header><div class="ax-l-i max-w-6xl"><div class=ax-logo><a class=block href=/ title="Youngjoon Lee"><span class="font-semibold text-raven-900">Youngjoon Lee</span></a></div><div class=ax-user><a class="p-2 w-8 h-8 block text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" target=_blank rel="noopener nofollow" href="https://www.google.com/search?q=site:oudwud.dev" title=Search><svg class="fill-current" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M2.67 12.804c0-5.6 4.544-10.134 10.133-10.134s10.134 4.544 10.134 10.134-4.544 10.133-10.134 10.133S2.67 18.393 2.67 12.804zm28.943 16.923-8.868-8.868c4.287-5.3 3.68-13.012-1.378-17.57S8.564-1.066 3.75 3.75s-5.017 12.558-.46 17.618 12.28 5.665 17.57 1.378l8.868 8.868a1.33 1.33.0 002.231-.597c.123-.46-.008-.952-.345-1.29h0z"/></svg></a><a class="p-2 block text-base leading-none text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" href=/posts/>Posts</a></div></div></header><main><div class=default-single><div class="ax-title ax-l-o"><div class="ax-l-i max-w-680"><h1 class="post-title font-content-title font-normal leading-tight tracking-default text-40">Why prevote in Tendermint</h1><div class="ax-meta flex items-center mt-5"><div class="flex-grow min-w-0"><div class="flex items-center"><div class=flex-shrink-0><img class="w-12 h-12 sm:w-14 sm:h-14 object-cover p-3px rounded-full border border-blue-300" src=/image/author/my.jpeg alt="Youngjoon Lee"></div><div class="flex-shrink-0 ml-2 leading-tight font-content-sans"><a class="block text-sm text-raven-800 hover:text-raven-900 hover:underline focus:underline" target=_blank rel="noopener nofollow" title="Youngjoon Lee" href=https://oudwud.dev>Youngjoon Lee</a>
<time class="text-sm text-raven-500" datetime=2023-04-18T12:06:00Z>2023-04-18 12:06 UTC</time></div></div></div><div><div class="flex items-center"><a class="flex-shrink-0 block text-raven-800 hover:text-raven-900" target=_blank rel="noopener nofollow" title="Share on Twitter" href="https://twitter.com/intent/tweet?text=Why%20prevote%20in%20Tendermint%20by%20%40%40oudwud%20https%3a%2f%2foudwud.dev%2f2304182106-why-prevote-in-tendermint%2f"><svg class="w-6 h-6 fill-current" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32 6.078c-1.2.522-2.458.868-3.78 1.036 1.36-.812 2.398-2.088 2.886-3.626a13.11 13.11.0 01-4.16 1.588C25.742 3.794 24.026 3 22.154 3a6.56 6.56.0 00-6.556 6.562c0 .52.044 1.02.152 1.496-5.454-.266-10.28-2.88-13.522-6.862-.566.982-.898 2.106-.898 3.316a6.57 6.57.0 002.914 5.452 6.48 6.48.0 01-2.964-.808v.072c0 3.188 2.274 5.836 5.256 6.446-.534.146-1.116.216-1.72.216-.42.0-.844-.024-1.242-.112.85 2.598 3.262 4.508 6.13 4.57A13.18 13.18.0 011.57 26.146c-.538.0-1.054-.024-1.57-.1C2.906 27.93 6.35 29 10.064 29c12.072.0 18.672-10 18.672-18.668.0-.3-.01-.57-.024-.848C30.014 8.56 31.108 7.406 32 6.078z"/></svg></a><a class="ml-3 flex-shrink-0 block text-raven-800 hover:text-raven-900" target=_blank rel="noopener nofollow" title="Share on Facebook" href="https://www.facebook.com/dialog/share?app_id=&display=page&href=https%3a%2f%2foudwud.dev%2f2304182106-why-prevote-in-tendermint%2f"><svg class="w-6 h-6 fill-current" viewBox="-7 -3.5 39 39" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M30.234.0H1.765C.8.001.0.79.0 1.766v28.47C.001 31.2.79 32 1.766 32h15.328V19.625h-4.156V14.78h4.156v-3.564c0-4.134 2.523-6.384 6.21-6.384 1.766.0 3.284.13 3.726.2v4.32h-2.543c-2.006.0-2.394.953-2.394 2.352v3.085h4.797l-.625 4.844h-4.172V32h8.14C31.21 32 32 31.2 32 30.234V1.765C32 .8 31.21.0 30.234.0z"/></svg></a></div></div></div></div></div><div class="ax-content ax-l-o"><div class="ax-l-i max-w-680"><article class=cdata><p>Tendermint Byzantine Fault Tolerance (hereafter BFT) consensus algorithm has two stages of voting before committing a block to the state,
while Raft consensus algorithm (that doesn't cover the Byzantine problem) has a single stage of preparation (aka. log replication) for committing a transaction.
When I first met Tendermint, I was most curious why Tendermint has the two-stage voting (prevote-precommit).</p><p>In <a href=https://atrium.lib.uoguelph.ca/xmlui/handle/10214/9769>Ethan Buchman 2016</a>, he mentioned as below:</p><blockquote><p>In asynchronous environments with Byzantine validators, a single stage
of voting, where each validator casts only one vote, is not sufficient to ensure
safety. In essence, because validators can act fraudulently, and because there
are no guarantees on message delivery time, a rogue validator can co-ordinate
some validators to commit a value while others, having not seen the commit,
go to a new round, within which they commit a different value.<br>A single stage of voting allows validators to tell each other what they
know about the proposal. But to tolerate Byzantine faults (which amounts,
essentially to lies, fraud, deceit, etc.), they must also tell each other what
they know about what other validators have professed to know about the
proposal. In other words, a second stage ensures that enough validators
witnessed the result of the first stage.</p></blockquote><p>That sounds reasonable, but I wanted to see a specific counterexample that explains why only precommit without prevote is not sufficient.</p><p>Fortunately, I found a counterexample from a <a href="https://www.reddit.com/r/cosmosnetwork/comments/8zwais/comment/e2nyg92/?utm_source=reddit&amp;utm_medium=web2x&amp;context=3">Reddit post</a>.
Below, I am going to go into details on this counterexample.</p><p>Let's assume that Tendermint has only single stage of voting (aka. precommit), and the network consists of the following validator nodes:</p><ul><li>100 validator nodes in the network<ul><li>28 offline nodes (e.g. due to network partitioning)</li><li>65 honest nodes</li><li>1 honest node (aka. <code>H</code>)</li><li>1 Byzantine node (aka. <code>B</code>)</li></ul></li></ul><p>Let's say the current round is <code>n</code>. A "valid" block is proposed by one of the validators.
Then, all 66 (= 65 + 1) honest nodes broadcast a precommit for this valid block.
But, let's imagine the case when the Byzantine node <code>B</code> sends <code>nil</code> to 65 honest nodes and itself, but a precommit to the honest node <code>H</code>.</p><p>In this case, <code>H</code> has 67 precommits (<code>> 100 * 2/3</code>) with its own vote. Then, <code>H</code> will commit the block.
However, all other nodes (65 honest + <code>B</code>) move to the next round <code>n+1</code> because they have only 66 precommits (<code>&lt; 100 * 2/3</code>).</p><p>This result is a breach of safety because the honest node <code>H</code> committed the block that all other honest nodes didn't commit.</p><p>If Tendermint has the prevote-precommit mechanism, the above example can be resolved safely.
Let's replace all precommits in the above example with prevotes.
Then, <code>H</code> will broadcast a precommit to all other nodes instead of committing the block to its state,
but it won't receive 2/3+ precommit from other nodes because all other nodes except <code>H</code> won't broadcast a precommit since they didn't receive 2/3+ prevotes.
As a result, all nodes will move to the next round <code>n+1</code> without committing the block.
Then, the consensus remains safe, even if any new block never be committed due to <code>B</code> in subsequent rounds.</p></article></div></div></div></main><footer class=footer><div class="ax-l-i max-w-6xl"><nav class="flex items-center justify-center"><a class="ml-3 first:ml-0 text-sm text-gray-600 hover:text-gray-800" href=/posts/>Posts</a>
<a class="ml-3 first:ml-0 text-sm text-gray-600 hover:text-gray-800" href=/about/>About</a>
<a class="ml-3 first:ml-0 text-sm text-gray-600 hover:text-gray-800" href=/contact/>Contact</a>
<a class="ml-3 first:ml-0 text-sm text-gray-600 hover:text-gray-800" href=/privacy/>Privacy</a></nav><div class="footer-social flex items-center justify-center mt-4"><a class="block mx-3 w-6 h-6 text-raven-700 hover:text-raven-900" target=_blank rel="noopener nofollow" title=GitHub href=https://github.com/youngjoon-lee><svg class="fill-current" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M15.998.0C7.164.0.0 7.35.0 16.417.0 23.67 4.584 29.82 10.944 31.994c.8.15 1.092-.356 1.092-.79l-.022-2.792c-4.45.99-5.4-2.202-5.4-2.202-.726-1.896-1.776-2.4-1.776-2.4-1.454-1.018.108-.998.108-.998 1.606.117 2.45 1.693 2.45 1.693 1.428 2.507 3.746 1.784 4.658 1.363.144-1.06.558-1.784 1.016-2.195-3.552-.415-7.288-1.823-7.288-8.113.0-1.792.624-3.258 1.648-4.406-.166-.415-.714-2.085.156-4.344.0.0 1.344-.44 4.4 1.683 1.276-.364 2.644-.546 4.006-.552a14.98 14.98.0 014.006.554C23.062 6.37 24.404 6.8 24.404 6.8c.872 2.26.324 3.93.16 4.344 1.026 1.148 1.644 2.614 1.644 4.406.0 6.306-3.74 7.694-7.304 8.1.574.507 1.086 1.51 1.086 3.04l-.02 4.503c0 .44.288.95 1.1.788C27.42 29.817 32 23.667 32 16.417 32 7.35 24.836.0 15.998.0z"/></svg></a><a class="block mx-3 w-6 h-6 text-raven-700 hover:text-raven-900" target=_blank rel="noopener nofollow" title=Twitter href=https://twitter.com/oudwud><svg class="fill-current" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32 6.078c-1.2.522-2.458.868-3.78 1.036 1.36-.812 2.398-2.088 2.886-3.626a13.11 13.11.0 01-4.16 1.588C25.742 3.794 24.026 3 22.154 3a6.56 6.56.0 00-6.556 6.562c0 .52.044 1.02.152 1.496-5.454-.266-10.28-2.88-13.522-6.862-.566.982-.898 2.106-.898 3.316a6.57 6.57.0 002.914 5.452 6.48 6.48.0 01-2.964-.808v.072c0 3.188 2.274 5.836 5.256 6.446-.534.146-1.116.216-1.72.216-.42.0-.844-.024-1.242-.112.85 2.598 3.262 4.508 6.13 4.57A13.18 13.18.0 011.57 26.146c-.538.0-1.054-.024-1.57-.1C2.906 27.93 6.35 29 10.064 29c12.072.0 18.672-10 18.672-18.668.0-.3-.01-.57-.024-.848C30.014 8.56 31.108 7.406 32 6.078z"/></svg></a><a class="block mx-3 w-6 h-6 text-raven-700 hover:text-raven-900" target=_blank rel="noopener nofollow" title=LinkedIn href=https://www.linkedin.com/in/youngjoon-lee-11ba7b72/><svg class="fill-current" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M29.692.0H2.308A2.31 2.31.0 000 2.308v27.384A2.31 2.31.0 002.308 32h27.384A2.31 2.31.0 0032 29.692V2.308A2.31 2.31.0 0029.692.0zM11.35 24.188H7.454V12.464h3.897v11.723zM9.402 10.863h-.025c-1.308.0-2.153-.9-2.153-2.025.0-1.15.872-2.026 2.205-2.026s2.153.875 2.18 2.026c0 1.125-.846 2.025-2.205 2.025zm16 13.324h-3.896v-6.272c0-1.576-.564-2.65-1.974-2.65-1.076.0-1.717.725-2 1.425-.103.25-.128.6-.128.95v6.547h-3.896V12.464h3.896v1.66c.518-.8 1.444-1.935 3.512-1.935 2.564.0 4.486 1.676 4.486 5.276v6.722z"/></svg></a></div><div class="footer-copyright text-sm text-center text-gray-400 mt-4">&#169; 2020-2023 Youngjoon Lee</div><div class="text-sm sm:text-xs text-center text-gray-400 mt-2">Powered by <a href="https://www.axiomtheme.com/?utm_source=theme-footer&utm_medium=website&utm_campaign=referral">Axiom</a></div></div></footer><script src="/bundle.js?v=1683215241"></script></body></html>